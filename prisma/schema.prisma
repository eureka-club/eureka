generator client {
  provider        = "prisma-client-js"
  previewFeatures = ["microsoftSqlServer"]
}

datasource db {
  provider = "sqlserver"
  url      = env("DATABASE_URL")
}


// Next-auth models (https://next-auth.js.org/schemas/adapters#prisma-schema)

model User {
  id             Int        @id @default(autoincrement())
  name           String?
  email          String?    @unique
  emailVerified  DateTime?  @map(name: "email_verified")
  image          String?
  roles          String     @default("member")
  createdAt      DateTime   @default(now()) @map(name: "created_at")
  updatedAt      DateTime   @updatedAt @map(name: "updated_at")

  accounts       Account[]
  sessions       Session[]

  cycles         Cycle[]
  posts          Post[]

  @@map(name: "users")
}

model Account {
  id                  Int        @id @default(autoincrement())
  user                User       @relation(fields: [userId], references: [id])
  userId              Int        @map(name: "user_id")
  compoundId          String     @unique @map(name: "compound_id")
  providerType        String     @map(name: "provider_type")
  providerId          String     @map(name: "provider_id")
  providerAccountId   String     @map(name: "provider_account_id")
  refreshToken        String?    @map(name: "refresh_token")
  accessToken         String?    @map(name: "access_token")
  accessTokenExpires  DateTime?  @map(name: "access_token_expires")
  createdAt           DateTime   @default(now()) @map(name: "created_at")
  updatedAt           DateTime   @updatedAt @map(name: "updated_at")

  @@index([userId], name: "accounts_user_id_index")
  @@index([providerId], name: "accounts_provider_id_index")
  @@index([providerAccountId], name: "accounts_provider_account_id_index")

  @@map(name: "accounts")
}

model Session {
  id            Int       @id @default(autoincrement())
  user          User      @relation(fields: [userId], references: [id])
  userId        Int       @map(name: "user_id")
  expires       DateTime
  sessionToken  String    @unique @map(name: "session_token")
  accessToken   String    @unique @map(name: "access_token")
  createdAt     DateTime  @default(now()) @map(name: "created_at")
  updatedAt     DateTime  @updatedAt @map(name: "updated_at")

  @@index([userId], name: "sessions_user_id_index")

  @@map(name: "sessions")
}

model VerificationRequest {
  id          Int       @id @default(autoincrement())
  identifier  String
  token       String    @unique
  expires     DateTime
  createdAt   DateTime  @default(now()) @map(name: "created_at")
  updatedAt   DateTime  @updatedAt @map(name: "updated_at")

  @@map(name: "verification_requests")
}


// App models

model LocalImage {
  id                Int       @default(autoincrement()) @id
  originalFilename  String    @map(name: "original_filename")
  storedFile        String    @map(name: "stored_file")
  mimeType          String    @map(name: "mime_type")
  contentHash       String    @map(name: "content_hash")
  createdAt         DateTime  @default(now()) @map(name: "created_at")
  updatedAt         DateTime  @map(name: "updated_at")

  cycles  Cycle[]
  posts   Post[]
  works   Work[]

  @@index([contentHash], name: "local_images_content_hash_index")

  @@map(name: "local_images")
}

model Work {
  id               Int        @default(autoincrement()) @id
  type             String
  title            String
  contentText      String?    @map(name: "content_text")
  author           String
  authorGender     String?    @map(name: "author_gender")
  authorRace       String?    @map(name: "author_race")
  link             String?
  publicationYear  DateTime?  @map(name: "publication_year")
  countryOfOrigin  String?    @map(name: "country_of_origin")
  length           String?
  createdAt        DateTime   @default(now()) @map(name: "created_at")
  updatedAt        DateTime   @map(name: "updated_at")

  localImages  LocalImage[]
  cycles       Cycle[]
  posts        Post[]

  @@index([title], name: "works_title_index")

  @@map(name: "works")
}

model Cycle {
  id           Int       @default(autoincrement()) @id
  creator      User      @relation(fields: [creatorId], references: [id])
  creatorId    Int       @map(name: "creator_id")
  title        String
  languages    String
  contentText  String?   @map(name: "content_text")
  startDate    DateTime  @map(name: "start_date")
  endDate      DateTime  @map(name: "end_date")
  createdAt    DateTime  @default(now()) @map(name: "created_at")
  updatedAt    DateTime  @map(name: "updated_at")

  localImages  LocalImage[]
  posts        Post[]
  works        Work[]

  @@index([creatorId], name: "cycles_creator_id_index")
  @@index([title], name: "cycles_title_index")

  @@map(name: "cycles")
}

model Post {
  id           Int       @default(autoincrement()) @id
  creator      User      @relation(fields: [creatorId], references: [id])
  creatorId    Int       @map(name: "creator_id")
  language     String
  contentText  String?   @map(name: "content_text")
  isPublic     Boolean   @map(name: "is_public")
  createdAt    DateTime  @default(now()) @map(name: "created_at")
  updatedAt    DateTime  @map(name: "updated_at")

  localImages  LocalImage[]
  cycles       Cycle[]
  works        Work[]

  @@index([creatorId], name: "posts_creator_id_index")

  @@map(name: "posts")
}
